{
    "id": "oppai-stream-online-streaming",
    "name": "4k | Oppai Stream (18+)",
    "version": "1.0.3",
    "manifestURI": "https://raw.githubusercontent.com/erickyun/seanime-extension/refs/heads/main/online-streaming/oppai-stream/manifest.json",
    "language": "typescript",
    "type": "onlinestream-provider",
    "description": "Provides seamless integration with the oppai.stream catalog for online streaming within Seanime, enabling users to watch available titles directly from the platform. Now includes 2160p (4K) quality support.",
    "author": "TropicalFrog3",
    "icon": "https://raw.githubusercontent.com/TropicalFrog3/seanime-extension/refs/heads/main/online-streaming/oppai-stream/favicon.png",
    "website": "",
    "lang": "en",
    "payload": "\n// by erickyun\n\nclass Provider {\n\n    private async findMediaUrls(type: VideoSourceType, html, serverUrl: string, resolutionMatch?: RegExpMatchArray, unpacked?: string): Promise<VideoSource[] | VideoSource | undefined> {\n\n        const regex = new RegExp('https?:\\\\/\\\\/[^\\'\\\"]+\\\\.' + type + '(?:\\\\?[^\\\\s\\'\\\"]*)?(?:#[^\\\\s\\'\\\"]*)?', 'g');\n\n        let VideoMatch = html.match(regex)\n            || unpacked?.match(regex)\n            || html.match(new RegExp(`\"([^\"]+\\\\.${type})\"`, \"g\"))\n            || unpacked?.match(new RegExp(`\"([^\"]+\\\\.${type})\"`, \"g\"));\n\n        if (VideoMatch) {\n            if (VideoMatch[0].includes(`master.${type}`)) {\n                const req = await fetch(`${this.SEANIME_API}${encodeURIComponent(VideoMatch[0])}`);\n                let reqHtml = await req.text();\n                reqHtml = decodeURIComponent(reqHtml);\n                let qual = \"\";\n                let url = \"\";\n                const videos: VideoSource[] = [];\n                if (reqHtml.includes(\"#EXTM3U\")) {\n                    reqHtml.split(\"\\n\").forEach(line => {\n                        if (line.startsWith(\"#EXT-X-STREAM-INF\")) {\n                            qual = line.split(\"RESOLUTION=\")[1]?.split(\",\")[0] || \"unknown\";\n                            const height = parseInt(qual.split(\"x\")[1]) || 0;\n\n                            if (height >= 4k) {\n                                qual = \"4k\";\n                            } else if (height >= 1080) {\n                                qual = \"1080p\";\n                            } else if (height >= 720) {\n                                qual = \"720p\";\n                            } else if (height >= 480) {\n                                qual = \"480p\";\n                            } else if (height >= 360) {\n                                qual = \"360p\";\n                            } else {\n                                qual = \"unknown\";\n                            }\n                        }\n                    });\n                }\n\n                if (videos.length > 0) {\n                    return videos.sort((a, b) => {\n                        const resolutionOrder = [\"4k\", \"1080p\", \"720p\", \"480p\", \"360p\", \"unknown\"];\n                        const aIndex = resolutionOrder.indexOf(a.quality.split(\" \")[2]);\n                        const bIndex = resolutionOrder.indexOf(b.quality.split(\" \")[2]);\n                        return aIndex - bIndex;\n                    });\n                }\n            }\n        }\n    }\n}\n"
}
